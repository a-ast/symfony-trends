services:
    http_client:
        class: AppBundle\Client\HttpClient
    github_client:
        class: Github\Client
    github_api_client:
        class: AppBundle\Aggregator\Helper\GithubApiClient
        arguments:
            - '@http_client'
            - '%github.client_id%'
            - '%github.client_secret%'
    geolocation_api_client:
        class: AppBundle\Aggregator\Helper\GeolocationApiClient
        arguments:
            - '@http_client'
            - '%geocoding.api_key%'

    #################################
    # Helpers
    #################################
    helper.contributor_extractor:
        class: AppBundle\Aggregator\Helper\ContributorExtractor
        lazy: true

    helper.sensiolabs_data_extractor:
        class: AppBundle\Aggregator\Helper\SensiolabsDataExtractor
        lazy: true

    helper.github_api:
        class: AppBundle\Aggregator\Helper\GithubApiAdapter
        lazy: true
        arguments:
            - '@github_client'
            - '%github.client_id%'
            - '%github.client_secret%'

    #################################
    # Data aggregators
    #################################
    aggregator.contributor_page:
        class: AppBundle\Aggregator\ContributorPage
        arguments:
            - '@http_client'
            - '@helper.contributor_extractor'
            - '@repository.contributor'

    aggregator.github_api:
        class: AppBundle\Aggregator\GithubApi
        lazy: true
        arguments:
            - '@github_api_client'
            - '@repository.contributor'

    aggregator.github_user_data:
        class: AppBundle\Aggregator\GithubUserData
        lazy: true
        arguments:
            - '@github_api_client'
            - '@geolocation_api_client'
            - '@repository.contributor'

    aggregator.github_commit_history:
        class: AppBundle\Aggregator\GithubCommitHistory
        lazy: true
        arguments:
            - '@github_api_client'
            - '@geolocation_api_client'
            - '@repository.project'
            - '@repository.contribution'
            - '@repository.contributor'

    aggregator.sensiolabs_connect:
        class: AppBundle\Aggregator\SensiolabsConnect
        lazy: true
        arguments:
            - '@http_client'
            - '@helper.sensiolabs_data_extractor'
            - '@repository.contributor'

    aggregator.sensiolabs_user_updater:
        class: AppBundle\Aggregator\SensiolabsUserUpdater
        lazy: true
        arguments:
            - '@repository.sensiolabs_user'
            - '@repository.contributor'

    #################################
    # Data providers
    #################################
    provider.contributors_intersection:
        class: AppBundle\Provider\ContributorsIntersection
        lazy: true
        arguments:
            - '@repository.contribution'
            - '@repository.project'

    provider.commit_count_distribution:
        class: AppBundle\Provider\CommitCountDistribution
        lazy: true
        arguments:
            - '@repository.contribution'
            - '@repository.project'

    provider.contributors_per_date:
        class: AppBundle\Provider\ContributorsPerDate
        lazy: true
        arguments:
            - '@repository.contribution'
